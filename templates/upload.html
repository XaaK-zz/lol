{% extends "base.html" %}

{% block title %}Add yours!{% endblock %}
{% load staticfiles %}

{% block content %}

<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    $('#import_gist').click(function(){ 
        code_box = $("textarea[name='code']");
        description_box = $("input[name='description']");
        language_box = $("select[name='language_id']");
        gist_id = $("input[name='gist_id']").val();
        url = "https://api.github.com/gists/" + gist_id;
        $.ajax({ 
            url      : url, 
            dataType : 'jsonp', 
            timeout  : 10000,
            success: function(response) {
                description_box.val(response['description']);
                for (file in response.data.files) {
                    if (response.data.files.hasOwnProperty(file)) {
                        var lang = response.data.files[file].language.trim();
                        if(lang){
                            var value = $("select option").filter(function() {
                                  return $(this).text() === lang;
                            }).first().attr("value");
                            language_box.val(value);
                        }
                        code_box.val(response.data.files[file].content);
                    }
                }
            }
        }); 
    });
});

</script>

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

<form action="{% url upload %}" method="post">
    {% csrf_token %}
    Description: <input type="text" name="description"/>
    <br/>
    Code:
    <textarea name="code" rows=30 cols=80></textarea>
    <br/>
    <select name="language_id">
{% for language in languages %}
    <option value="{{ language.id }}">{{ language.name }}</option>
{% endfor %}
    </select>
    <br/>
<input type="submit" value="Submit" />
</form>
<div class="import_gist"> 
    Import gist by id: <input type="text" name="gist_id" />
    <input type="submit" id="import_gist" value="Import" />
</div>


{% endblock %}

